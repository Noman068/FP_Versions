<div class="search-container">
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">
        <i class="fas fa-search"></i> Search Patients
      </h3>
    </div>
    <div class="card-body">
      <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
        <!-- Error Alert -->
        @if (error$ | async; as error) {
          <div class="alert alert-danger d-flex justify-content-between align-items-center">
            <span>{{ error }}</span>
            <button class="btn btn-sm btn-outline-danger" (click)="clearError()">
              <i class="fas fa-times"></i>
            </button>
          </div>
        }

        <div class="input-group">
          <input
            type="text"
            class="form-control"
            [class.error]="searchForm.get('fullName')?.invalid && searchForm.get('fullName')?.touched"
            formControlName="fullName"
            placeholder="Enter patient's full name..."
            autocomplete="off"
          />
          <button
            class="btn btn-outline-secondary"
            type="button"
            (click)="clearSearch()"
            title="Clear Search"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        @if (getFieldError()) {
          <div class="form-error">{{ getFieldError() }}</div>
        }
      </form>

      <!-- Search Results -->
      @if (isSearching$ | async) {
        <div class="search-results mt-3">
          <h5>Search Results</h5>
          
          @if (loading$ | async) {
            <div class="text-center">
              <div class="spinner"></div>
              <p>Searching...</p>
            </div>
          } @else {
            @if ((searchResults$ | async)?.length === 0) {
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                No patients found matching your search criteria.
              </div>
            } @else {
              <div class="table-responsive">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Gender</th>
                      <th>Email</th>
                      <th>Phone</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (patient of searchResults$ | async; track patient.patientId) {
                      <tr>
                        <td>{{ patient.patientId }}</td>
                        <td>
                          <strong>{{ patient.firstname }} {{ patient.lastname }}</strong>
                        </td>
                        <td>{{ patient.gender }}</td>
                        <td>{{ patient.email }}</td>
                        <td>{{ patient.phoneNo }}</td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            }
          }
        </div>
      }
    </div>
  </div>
</div>
